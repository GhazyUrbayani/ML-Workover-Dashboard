<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML Workover Optimization Dashboard | IPFEST 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            height: 100%;
            overflow: hidden;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            padding: 12px;
            color: #e0e0e0;
        }
        
        .dashboard-container {
            max-width: 1920px;
            height: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
        }
        
        /* Upload Section - TOP PRIORITY */
        .upload-section {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border-radius: 12px;
            border: 2px solid rgba(102, 126, 234, 0.5);
            padding: 15px 20px;
            margin-bottom: 12px;
        }
        
        .upload-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .upload-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .upload-title h2 {
            font-size: 1.2rem;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .upload-title span {
            color: #a0a0a0;
            font-size: 0.85rem;
        }
        
        .upload-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .file-input-wrapper {
            position: relative;
        }
        
        .file-input-wrapper input[type="file"] {
            padding: 8px 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .upload-status {
            font-size: 0.85rem;
            padding: 6px 12px;
            border-radius: 6px;
            background: rgba(0,0,0,0.2);
        }
        
        /* Main Grid - 4 Sections */
        .main-grid {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 12px;
            min-height: 0;
        }
        
        .section-card {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .section-card h3 {
            color: #667eea;
            font-size: 1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .section-content {
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
        }
        
        /* KPI Mini Cards */
        .kpi-mini-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .kpi-mini {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            border-left: 3px solid #667eea;
        }
        
        .kpi-mini.success { border-color: #10b981; }
        .kpi-mini.warning { border-color: #f59e0b; }
        .kpi-mini.danger { border-color: #ef4444; }
        .kpi-mini.info { border-color: #3b82f6; }
        
        .kpi-mini-label { font-size: 0.7rem; color: #a0a0a0; text-transform: uppercase; }
        .kpi-mini-value { font-size: 1.3rem; font-weight: bold; color: #fff; margin-top: 4px; }
        .kpi-mini-delta { font-size: 0.7rem; color: #10b981; }
        .kpi-mini-delta.negative { color: #ef4444; }
        
        /* Chart Container */
        .chart-container {
            flex: 1;
            position: relative;
            min-height: 0;
        }
        
        .chart-container canvas {
            max-height: 100% !important;
        }
        
        /* Heterogeneity Quadrant - FIXED */
        .hetero-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .hetero-description {
            font-size: 0.75rem;
            color: #a0a0a0;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .quadrant-outer {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .quadrant-grid {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 8px;
        }
        
        .quadrant {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            padding: 8px;
            text-align: center;
        }
        
        .quadrant.q1 { background: rgba(16, 185, 129, 0.25); border: 2px solid #10b981; }
        .quadrant.q2 { background: rgba(245, 158, 11, 0.25); border: 2px solid #f59e0b; }
        .quadrant.q3 { background: rgba(59, 130, 246, 0.25); border: 2px solid #3b82f6; }
        .quadrant.q4 { background: rgba(239, 68, 68, 0.25); border: 2px solid #ef4444; }
        
        .quadrant-number { font-size: 1.8rem; font-weight: bold; line-height: 1; }
        .quadrant-label { font-size: 0.7rem; color: #d0d0d0; margin: 4px 0; }
        .quadrant-count { font-size: 1.1rem; font-weight: bold; }
        .quadrant-rate { font-size: 0.75rem; }
        .quadrant.q1 .quadrant-rate { color: #10b981; }
        .quadrant.q2 .quadrant-rate { color: #f59e0b; }
        .quadrant.q3 .quadrant-rate { color: #3b82f6; }
        .quadrant.q4 .quadrant-rate { color: #ef4444; }
        
        .axis-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        
        .axis-label-x {
            font-size: 0.7rem;
            color: #667eea;
            text-align: center;
            flex: 1;
        }
        
        .axis-label-y {
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%) rotate(-90deg);
            font-size: 0.7rem;
            color: #667eea;
            white-space: nowrap;
        }
        
        /* Production Lifecycle Chart */
        .lifecycle-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .lifecycle-stat {
            text-align: center;
            padding: 8px 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }
        
        .lifecycle-stat-label { font-size: 0.7rem; color: #a0a0a0; }
        .lifecycle-stat-value { font-size: 1.1rem; font-weight: bold; }
        .lifecycle-stat-value.before { color: #ef4444; }
        .lifecycle-stat-value.after { color: #10b981; }
        .lifecycle-stat-value.increase { color: #667eea; }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 8px;
            color: #666;
            font-size: 0.75rem;
            flex-shrink: 0;
        }
        
        .footer span { margin: 0 10px; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- UPLOAD SECTION - TOP -->
        <div class="upload-section">
            <div class="upload-header">
                <div class="upload-title">
                    <h2>üì§ Upload Dataset</h2>
                    <span>Well-level CSV (CUM_OIL, CUM_WATER, features)</span>
                </div>
                <div class="upload-controls">
                    <div class="file-input-wrapper">
                        <input type="file" id="csvFile" accept=".csv">
                    </div>
                    <button class="btn btn-primary" onclick="uploadAndPredict()" id="predictBtn">
                        üöÄ Run Prediction
                    </button>
                    <button class="btn btn-secondary" onclick="loadFromAPI()">
                        üîÑ Load Last Results
                    </button>
                    <div class="upload-status" id="uploadStatus">
                        <span id="apiStatus">Checking API...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- MAIN 4-SECTION GRID -->
        <div class="main-grid">
            <!-- 1. WORKOVER ACTIVITIES -->
            <div class="section-card">
                <h3>üìä Workover Activities</h3>
                <div class="section-content">
                    <div class="kpi-mini-grid" id="workoverKpis">
                        <div class="kpi-mini">
                            <div class="kpi-mini-label">Total Wells</div>
                            <div class="kpi-mini-value" id="totalWells">-</div>
                        </div>
                        <div class="kpi-mini success">
                            <div class="kpi-mini-label">Strongly Recommend</div>
                            <div class="kpi-mini-value" id="stronglyRec">-</div>
                        </div>
                        <div class="kpi-mini warning">
                            <div class="kpi-mini-label">Review by Engineer</div>
                            <div class="kpi-mini-value" id="reviewEng">-</div>
                        </div>
                        <div class="kpi-mini danger">
                            <div class="kpi-mini-label">Low Priority</div>
                            <div class="kpi-mini-value" id="lowPriority">-</div>
                        </div>
                        <div class="kpi-mini info">
                            <div class="kpi-mini-label">Test Set</div>
                            <div class="kpi-mini-value" id="testWells">-</div>
                        </div>
                        <div class="kpi-mini">
                            <div class="kpi-mini-label">Intervened</div>
                            <div class="kpi-mini-value" id="intervenedWells">-</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="advisoryChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- 2. SUCCESS SCORE -->
            <div class="section-card">
                <h3>üéØ Success Score & Model Performance</h3>
                <div class="section-content">
                    <div class="kpi-mini-grid">
                        <div class="kpi-mini success">
                            <div class="kpi-mini-label">ROC AUC</div>
                            <div class="kpi-mini-value" id="rocAuc">-</div>
                        </div>
                        <div class="kpi-mini">
                            <div class="kpi-mini-label">Accuracy</div>
                            <div class="kpi-mini-value" id="accuracy">-</div>
                        </div>
                        <div class="kpi-mini info">
                            <div class="kpi-mini-label">Precision</div>
                            <div class="kpi-mini-value" id="precision">-</div>
                        </div>
                        <div class="kpi-mini warning">
                            <div class="kpi-mini-label">Recall</div>
                            <div class="kpi-mini-value" id="recall">-</div>
                        </div>
                        <div class="kpi-mini success">
                            <div class="kpi-mini-label">True Positive</div>
                            <div class="kpi-mini-value" id="truePos">-</div>
                        </div>
                        <div class="kpi-mini danger">
                            <div class="kpi-mini-label">False Negative</div>
                            <div class="kpi-mini-value" id="falseNeg">-</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="rocChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- 3. PRODUCTION LIFECYCLE & INCREASED PRODUCTION -->
            <div class="section-card">
                <h3>üìà Production Lifecycle & Intervention Impact</h3>
                <div class="section-content">
                    <div class="chart-container" style="flex: 1;">
                        <canvas id="productionCurveChart"></canvas>
                    </div>
                    <div class="lifecycle-info">
                        <div class="lifecycle-stat">
                            <div class="lifecycle-stat-label">Before Workover</div>
                            <div class="lifecycle-stat-value before" id="prodBefore">- bbl/day</div>
                        </div>
                        <div class="lifecycle-stat">
                            <div class="lifecycle-stat-label">After Workover</div>
                            <div class="lifecycle-stat-value after" id="prodAfter">- bbl/day</div>
                        </div>
                        <div class="lifecycle-stat">
                            <div class="lifecycle-stat-label">Net Increase</div>
                            <div class="lifecycle-stat-value increase" id="prodIncrease">- (+0%)</div>
                        </div>
                        <div class="lifecycle-stat">
                            <div class="lifecycle-stat-label">Extended Life</div>
                            <div class="lifecycle-stat-value" style="color:#f093fb;" id="extendedLife">+5-10 years</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 4. COST OPTIMIZATION + HETEROGENEITY INDEX -->
            <div class="section-card">
                <h3>üí∞ Cost Optimization & üî¨ Heterogeneity Index</h3>
                <div class="section-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <!-- Cost Section -->
                    <div style="display: flex; flex-direction: column;">
                        <div class="kpi-mini-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="kpi-mini danger">
                                <div class="kpi-mini-label">Baseline Cost</div>
                                <div class="kpi-mini-value" id="baselineCost">-</div>
                            </div>
                            <div class="kpi-mini success">
                                <div class="kpi-mini-label">Optimized Cost</div>
                                <div class="kpi-mini-value" id="optimizedCost">-</div>
                            </div>
                            <div class="kpi-mini" style="grid-column: span 2;">
                                <div class="kpi-mini-label">Total Savings</div>
                                <div class="kpi-mini-value" style="color:#667eea;" id="totalSavings">-</div>
                                <div class="kpi-mini-delta" id="savingsPct">-% reduction</div>
                            </div>
                        </div>
                        <div class="chart-container" style="flex: 1;">
                            <canvas id="costChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Heterogeneity Index Section -->
                    <div class="hetero-wrapper" style="position: relative;">
                        <div class="hetero-description">
                            Wells classified by Net Oil & Water Production
                        </div>
                        <div class="quadrant-outer">
                            <span class="axis-label-y">‚Üë Water Production</span>
                            <div class="quadrant-grid">
                                <div class="quadrant q4">
                                    <div class="quadrant-number">4</div>
                                    <div class="quadrant-label">Low Oil - High Water</div>
                                    <div class="quadrant-count" id="q4Count">- wells</div>
                                    <div class="quadrant-rate" id="q4Rate">-% Success</div>
                                </div>
                                <div class="quadrant q2">
                                    <div class="quadrant-number">2</div>
                                    <div class="quadrant-label">High Oil - High Water</div>
                                    <div class="quadrant-count" id="q2Count">- wells</div>
                                    <div class="quadrant-rate" id="q2Rate">-% Success</div>
                                </div>
                                <div class="quadrant q3">
                                    <div class="quadrant-number">3</div>
                                    <div class="quadrant-label">Low Oil - Low Water</div>
                                    <div class="quadrant-count" id="q3Count">- wells</div>
                                    <div class="quadrant-rate" id="q3Rate">-% Success</div>
                                </div>
                                <div class="quadrant q1">
                                    <div class="quadrant-number">1</div>
                                    <div class="quadrant-label">High Oil - Low Water</div>
                                    <div class="quadrant-count" id="q1Count">- wells</div>
                                    <div class="quadrant-rate" id="q1Rate">-% Success</div>
                                </div>
                            </div>
                            <div class="axis-labels">
                                <span class="axis-label-x">‚Üê Low Oil | High Oil ‚Üí</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <span>¬© 2026 Hengker Berkelas Team</span>
            <span>|</span>
            <span>Powered by LightGBM & Chart.js</span>
            <span>|</span>
            <span>Last Updated: <span id="lastUpdate">-</span></span>
        </div>
    </div>
    
    <script>
        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://127.0.0.1:5000' : '';
        
        let dashboardData = {
            kpis: {
                totalWells: 625, testWells: 300, rocAuc: 0.773,
                accuracy: 0.827, precision: 0.817, recall: 0.917,
                totalCostBaseline: 167740000, totalCostOptimized: 96355000, costSaving: 71385000,
                stronglyRecommend: 165, reviewEngineer: 78, lowPriority: 57
            },
            confusionMatrix: { tn: 83, fp: 37, fn: 15, tp: 165 },
            rocCurve: {
                fpr: [0.0, 0.05, 0.1, 0.15, 0.2, 0.25, 0.31, 0.4, 0.5, 0.7, 1.0],
                tpr: [0.0, 0.45, 0.62, 0.72, 0.78, 0.83, 0.87, 0.92, 0.96, 0.99, 1.0]
            },
            heteroIndex: [
                { index: 1, label: "High Oil - Low Water", count: 156, success_rate: 0.72 },
                { index: 2, label: "High Oil - High Water", count: 157, success_rate: 0.58 },
                { index: 3, label: "Low Oil - Low Water", count: 156, success_rate: 0.42 },
                { index: 4, label: "Low Oil - High Water", count: 156, success_rate: 0.28 }
            ],
            productionData: {
                beforeIntervention: [1000, 920, 850, 785, 725, 670, 620, 575, 532, 492, 455, 420],
                duringWorkover: [420, 50, 20, 10],
                afterIntervention: [10, 650, 780, 820, 845, 860, 870, 875, 878, 880, 881, 882]
            }
        };
        
        let charts = {};
        
        function renderKpis() {
            const k = dashboardData.kpis;
            const cm = dashboardData.confusionMatrix;
            
            document.getElementById('totalWells').textContent = k.totalWells.toLocaleString();
            document.getElementById('testWells').textContent = k.testWells;
            document.getElementById('stronglyRec').textContent = k.stronglyRecommend;
            document.getElementById('reviewEng').textContent = k.reviewEngineer;
            document.getElementById('lowPriority').textContent = k.lowPriority;
            document.getElementById('intervenedWells').textContent = k.stronglyRecommend + k.reviewEngineer;
            
            document.getElementById('rocAuc').textContent = k.rocAuc.toFixed(3);
            document.getElementById('accuracy').textContent = (k.accuracy * 100).toFixed(1) + '%';
            document.getElementById('precision').textContent = (k.precision * 100).toFixed(1) + '%';
            document.getElementById('recall').textContent = (k.recall * 100).toFixed(1) + '%';
            document.getElementById('truePos').textContent = cm.tp;
            document.getElementById('falseNeg').textContent = cm.fn;
            
            document.getElementById('baselineCost').textContent = '$' + (k.totalCostBaseline / 1e6).toFixed(1) + 'M';
            document.getElementById('optimizedCost').textContent = '$' + (k.totalCostOptimized / 1e6).toFixed(1) + 'M';
            document.getElementById('totalSavings').textContent = '$' + (k.costSaving / 1e6).toFixed(1) + 'M';
            document.getElementById('savingsPct').textContent = '‚Üì' + ((k.costSaving / k.totalCostBaseline) * 100).toFixed(1) + '% reduction';
            
            const prod = dashboardData.productionData;
            const beforeFinal = prod.beforeIntervention[prod.beforeIntervention.length - 1];
            const afterFinal = prod.afterIntervention[prod.afterIntervention.length - 1];
            const increase = afterFinal - beforeFinal;
            const increasePct = ((increase / beforeFinal) * 100).toFixed(1);
            
            document.getElementById('prodBefore').textContent = beforeFinal + ' bbl/day';
            document.getElementById('prodAfter').textContent = afterFinal + ' bbl/day';
            document.getElementById('prodIncrease').textContent = '+' + increase + ' (+' + increasePct + '%)';
        }
        
        function renderHeteroQuadrant() {
            dashboardData.heteroIndex.forEach(h => {
                const qCount = document.getElementById(`q${h.index}Count`);
                const qRate = document.getElementById(`q${h.index}Rate`);
                if (qCount) qCount.textContent = h.count + ' wells';
                if (qRate) qRate.textContent = (h.success_rate * 100).toFixed(1) + '% Success';
            });
        }
        
        function renderAdvisoryChart() {
            const ctx = document.getElementById('advisoryChart').getContext('2d');
            const k = dashboardData.kpis;
            
            if (charts.advisory) charts.advisory.destroy();
            charts.advisory = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Strongly Recommend', 'Review by Engineer', 'Low Priority'],
                    datasets: [{
                        data: [k.stronglyRecommend, k.reviewEngineer, k.lowPriority],
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: '#e0e0e0', boxWidth: 12, padding: 8, font: { size: 10 } } } }
                }
            });
        }
        
        function renderROCChart() {
            const ctx = document.getElementById('rocChart').getContext('2d');
            const roc = dashboardData.rocCurve;
            
            if (charts.roc) charts.roc.destroy();
            charts.roc = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: roc.fpr.map(v => v.toFixed(2)),
                    datasets: [
                        { label: `ROC (AUC=${dashboardData.kpis.rocAuc})`, data: roc.tpr, borderColor: '#f97316', backgroundColor: 'rgba(249,115,22,0.2)', borderWidth: 2, fill: true, tension: 0.4, pointRadius: 0 },
                        { label: 'Random', data: roc.fpr, borderColor: '#6366f1', borderWidth: 1, borderDash: [5,5], fill: false, pointRadius: 0 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: '#e0e0e0', boxWidth: 12, padding: 8, font: { size: 10 } } } },
                    scales: {
                        x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888', font: { size: 9 } }, title: { display: true, text: 'FPR', color: '#667eea', font: { size: 10 } } },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888', font: { size: 9 } }, title: { display: true, text: 'TPR', color: '#667eea', font: { size: 10 } } }
                    }
                }
            });
        }
        
        function renderProductionCurve() {
            const ctx = document.getElementById('productionCurveChart').getContext('2d');
            const prod = dashboardData.productionData;
            
            const phases = ['Exploration', 'Appraisal', 'Development', 'Build-up', 'Plateau', 'Normal Decline', 'Intervention', 'Extended Production', 'Abandonment'];
            const cashflowData = [-50, -30, -20, 10, 80, 60, 40, 55, 30];
            const productionRate = [0, 5, 30, 70, 100, 75, 20, 65, 25];
            
            if (charts.production) charts.production.destroy();
            charts.production = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: phases,
                    datasets: [
                        {
                            label: 'Production Rate (%)',
                            data: productionRate,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Cumulative Cashflow',
                            data: cashflowData,
                            borderColor: '#3b82f6',
                            borderDash: [5, 5],
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: {
                        legend: { position: 'top', labels: { color: '#e0e0e0', boxWidth: 12, padding: 8, font: { size: 10 } } },
                        annotation: {
                            annotations: {
                                interventionBox: {
                                    type: 'box',
                                    xMin: 5.5, xMax: 6.5,
                                    backgroundColor: 'rgba(102, 126, 234, 0.3)',
                                    borderColor: '#667eea',
                                    borderWidth: 2,
                                    label: { display: true, content: 'WORKOVER', position: 'start', color: '#fff', font: { size: 9 } }
                                }
                            }
                        }
                    },
                    scales: {
                        x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888', font: { size: 8 }, maxRotation: 45, minRotation: 45 } },
                        y: { type: 'linear', position: 'left', grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#ef4444', font: { size: 9 } }, title: { display: true, text: 'Production', color: '#ef4444', font: { size: 10 } } },
                        y1: { type: 'linear', position: 'right', grid: { drawOnChartArea: false }, ticks: { color: '#3b82f6', font: { size: 9 } }, title: { display: true, text: 'Cashflow', color: '#3b82f6', font: { size: 10 } } }
                    }
                }
            });
        }
        
        function renderCostChart() {
            const ctx = document.getElementById('costChart').getContext('2d');
            const k = dashboardData.kpis;
            
            if (charts.cost) charts.cost.destroy();
            charts.cost = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Baseline', 'Optimized', 'Savings'],
                    datasets: [{
                        data: [k.totalCostBaseline, k.totalCostOptimized, k.costSaving],
                        backgroundColor: ['#ef4444', '#10b981', '#667eea'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => '$' + (ctx.raw / 1e6).toFixed(1) + 'M' } } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#888', font: { size: 9 } } },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888', font: { size: 9 }, callback: v => '$' + (v / 1e6).toFixed(0) + 'M' } }
                    }
                }
            });
        }
        
        async function checkAPIHealth() {
            const statusEl = document.getElementById('apiStatus');
            try {
                const response = await fetch(`${API_BASE_URL}/api/health`, { timeout: 3000 });
                const data = await response.json();
                statusEl.innerHTML = data.model_loaded 
                    ? '<span style="color:#10b981;">‚úÖ API Ready</span>'
                    : '<span style="color:#f59e0b;">‚ö†Ô∏è No Model</span>';
            } catch (e) {
                statusEl.innerHTML = '<span style="color:#ef4444;">‚ùå Offline</span>';
            }
        }
        
        async function loadFromAPI() {
            const statusEl = document.getElementById('uploadStatus');
            statusEl.innerHTML = '<span style="color:#f59e0b;">‚è≥ Loading...</span>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/dashboard-data`);
                if (!response.ok) throw new Error('API error');
                dashboardData = await response.json();
                initDashboard();
                statusEl.innerHTML = '<span style="color:#10b981;">‚úÖ Loaded from API</span>';
            } catch (e) {
                statusEl.innerHTML = '<span style="color:#ef4444;">‚ùå Using sample data</span>';
            }
        }
        
        async function uploadAndPredict() {
            const fileInput = document.getElementById('csvFile');
            const statusEl = document.getElementById('uploadStatus');
            
            if (!fileInput.files.length) {
                statusEl.innerHTML = '<span style="color:#ef4444;">‚ö†Ô∏è Select CSV first!</span>';
                return;
            }
            
            statusEl.innerHTML = '<span style="color:#f59e0b;">‚è≥ Predicting...</span>';
            
            try {
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                
                const response = await fetch(`${API_BASE_URL}/api/predict`, { method: 'POST', body: formData });
                const data = await response.json();
                
                if (data.error) throw new Error(data.error);
                
                dashboardData.kpis.stronglyRecommend = data.summary.strongly_recommend;
                dashboardData.kpis.reviewEngineer = data.summary.review_engineer;
                dashboardData.kpis.lowPriority = data.summary.low_priority;
                dashboardData.kpis.totalWells = data.summary.total_wells;
                
                initDashboard();
                statusEl.innerHTML = `<span style="color:#10b981;">‚úÖ ${data.summary.total_wells} wells predicted!</span>`;
            } catch (e) {
                statusEl.innerHTML = `<span style="color:#ef4444;">‚ùå ${e.message}</span>`;
            }
        }
        
        function initDashboard() {
            renderKpis();
            renderHeteroQuadrant();
            renderAdvisoryChart();
            renderROCChart();
            renderProductionCurve();
            renderCostChart();
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('id-ID');
        }
        
        initDashboard();
        checkAPIHealth();
    </script>
</body>
</html>
